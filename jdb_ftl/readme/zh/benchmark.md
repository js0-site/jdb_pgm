# 测试基准与工程健壮性：信任的由来

作为存储系统的核心组件，JDB-FTL 将正确性与性能稳定性置于首位。本章将介绍我们的测试基准体系如何确保每一行代码变更都能经受住真实工作负载的考验。


## 1. 工业级 Trace 回放系统

JDB-FTL 的评估不依赖于简单的随机数生成，而是基于真实的 IO 行为：

### 1.1 Trace 通道
*   **物理实现**：支持变长二进制格式的轨迹解析，能够 1:1 还原真实的 LBA 读写序列。
*   **主流支持**：内置适配了 MSR Cambridge (MSRC) 等工业级标准数据集，模拟从 Web Server 到 Exchange Server 的多种业务模型。

### 1.2 高速回放引擎
*   **百万级回放**：得益于读路径的极致优化，单线程回放能力可达 **0.6 亿/秒**，这使得我们可以在几秒钟内完成对数小时生产流量的压力测试。


## 2. 自动化性能回归

我们不只关注瞬时性能，更关注**性能持续性**。

### 2.1 性能基准线追踪
*   **工具路径**：`./regress.js`
*   **功能描述**：该脚本会自动对比当前构建与基准版本（Baseline）的各项指标，并生成色块标注的对比报告。
*   **监控指标**：
    - **内存超载**：映射表内存占用的增额。
    - **吞吐量 (MB/s)**：相比纯内存数组的吞吐损耗百分比。
    - **延迟分位数**：P50, P90, P99 的全方位对比。

### 2.2 构建准入原则
如果当前修改导致内存占用增加超过 1% 或读取延迟增加超过 5%，回归脚本将抛出警告，强制开发者重新审视空间权衡。


## 3. 正确性验证闭环

为了确保在压缩和增量更新过程中不丢失任何比特，JDB-FTL 建立了三级防御体系：

1.  **单元验证**：
    验证 PGM 核心拟合逻辑在斜率溢出、零位宽、负斜率等极限情况下的正确性。

2.  **集成回放测试**：
    运行 `cargo test --test verify`。该测试会运行一个完整的 FTL 映射实例，对百万条映射执行“一边写、一边刷、一边读”的操作，并与真实的哈希表进行逐一比对。

3.  **并发防御测试**：
    模拟脏区域探测逻辑。在高频写入干扰下，验证后台刷新线程产生的 PGM 块是否能够 100% 精确还原数据。


## 4. 结论

在 JDB-FTL 中，文档、代码与测试是三位一体的。严格的基准测试体系不仅保障了产品的工业级品质，也为我们的持续优化提供了最可靠的反馈回路。每一个性能指标的提升，都有案可查。
